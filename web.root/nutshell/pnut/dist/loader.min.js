var Peanut;!function(o){var n=function(){function o(){}return o.loaded=!1,o.values={},o}();o.Config=n;var e=function(){return function(){}}();o.ui=e;var i=function(){function e(){}return e.startApplication=function(o,n){e.getConfig(function(i){e.load(i.dependencies,function(){null==e.application?(e.application=new window.Peanut.Application).initialize(function(){e.application.startVM(o,n)}):e.application.startVM(o,n)})})},e.loadUiHelper=function(n){var i=o.Config.values.uiExtension,a=i+"UiHelper";e.loadExtensionClass(i,a,function(e){o.ui.helper=e,n()})},e.load=function(o,n){if(o)switch(o instanceof Array||(o=o.split(",")),o.length){case 0:return void n();case 1:return void e.getConfig(function(){e.loadScript(o[0],n)});default:return void e.getConfig(function(){e.loadScripts(o,n)})}else n()},e.checkConfig=function(){if(!o.Config.loaded)throw"Config was not loaded. Call PeanutLoader.getConfig in startup."},e.getConfig=function(n){o.Config.loaded?n(o.Config.values):jQuery.getJSON("/peanut/settings",function(e){"verbose"==e.loggingMode&&console.log("retrieved config"),o.Config.loaded=!0,o.Config.values.applicationVersionNumber="0.2."+e.applicationVersionNumber,o.Config.values.commonRootPath=e.commonRootPath,o.Config.values.peanutRootPath=e.peanutRootPath,o.Config.values.packagePath=e.packagePath,o.Config.values.mvvmPath=e.mvvmPath,o.Config.values.corePath=e.corePath,o.Config.values.serviceUrl=e.serviceUrl,o.Config.values.dependencies=e.dependencies,o.Config.values.vmNamespace=e.vmNamespace,o.Config.values.loggingMode=e.loggingMode,o.Config.values.uiExtension=e.uiExtension,o.Config.values.libraries=e.libraries,"verbose"==e.loggingMode&&console.log("Namespace "+o.Config.values.vmNamespace),n(o.Config.values)})},e.loadScript=function(n,i){if(!o.Config.loaded)throw"Peanut Config was not loaded.";n.split(".").pop().toLowerCase();-1==e.loaded.indexOf(n)?head.load(n+"?v="+o.Config.values.applicationVersionNumber,function(){"verbose"==o.Config.values.loggingMode&&console.log("Loaded "+n),e.loaded.push(n),i()}):("verbose"==o.Config.values.loggingMode&&console.log("Skipped "+n),i())},e.loadScripts=function(n,i){if(!o.Config.loaded)throw"Peanut Config was not loaded.";for(var a=n.length,t=[],l=0;l<a;l++){var s=n[l];-1==e.loaded.indexOf(s)&&("js"==s.split(".").pop().toLowerCase()&&(e.loaded.push(s),"verbose"==o.Config.values.loggingMode&&console.log("Loaded "+s),s+="?v="+o.Config.values.applicationVersionNumber),t.unshift(s))}head.load(t,i)},e.loadExtensionClass=function(o,i,a){var t=n.values.peanutRootPath+"extensions/"+o+"/classes/"+i+".js";e.loadScript(t,function(){window.Peanut[i],window.Peanut[i];var o=new window.Peanut[i];a(o)})},e.loadHtml=function(n,i){e.checkConfig(),jQuery.get(n+"?v="+o.Config.values.applicationVersionNumber,i)},e.loaded=[],e}();o.PeanutLoader=i}(Peanut||(Peanut={}));